@model NatisTracker.ViewModels.DeliveryitemViewModel

<!DOCTYPE html>
@{
    ViewBag.Title = "DealershipView";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Dealership &middot; FindMy Natis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <style type="text/css">

        #myTab ul {
            display: none;
        }

        #myTab li:hover > ul {
            display: block;
            /*background:transparent;*/
        }

        .container {
            height: 100%;
            padding: 5px 5px 5px 5px;
            margin-left: 1%;
            margin-right: 1%;
            width: 98%;
        }

    </style>

</head>

<body>
    <div class="container">
        <ul class="nav nav-tabs nav-pills" data-tabs="tabs" id="myTab">
            <li class="active"><a data-toggle="tab" href="#SendPackage">Send Package</a></li>
            <li class="dropdown" id="drop">
                <a class="dropdown-toggle" data-toggle="dropdown">View Package Info <span class="caret"></span></a>
                <ul class="dropdown-menu" data-tabs="tabs" id="mySubTabs">
                    <li><a data-toggle="tab" href="#Courier">Sent By Courier</a></li>
                    <li><a data-toggle="tab" href="#Driver">Sent By Driver</a></li>
                </ul>
            </li>
            <li><a data-toggle="tab" href="#SearchNatis">Search Natis</a></li>
        </ul>

        <div class="tab-content">
            <div id="SendPackage" class="tab-pane fade in active">

                <h3>Send Package Form</h3>
                <br /><br />

                @using (Html.BeginForm("DealershipView", "Users", FormMethod.Post))
                {
                    @Html.HiddenFor(model => model.DealershipName)
                    @Html.HiddenFor(model => model.SenderEmail)
                    @Html.HiddenFor(model => model.FName)
                    @Html.HiddenFor(model => model.LName)

                    @Html.HiddenFor(model => model.ContractStrings)

                    @Html.AntiForgeryToken()

                    <fieldset>
                        
                        <div class="form-group">
                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                            @Html.LabelFor(a => a.DeliveryChoice, "Delivery Choice", new { @class = "col-md-2 control-label" })
                            <div class="col-md-2">
                                @using (Html.BeginForm("DealershipView", "Users", FormMethod.Post))
                                {
                                    @Html.DropDownListFor(a => a.DeliveryChoice, new List<SelectListItem>
                                    {
                                        new SelectListItem { Text="Courier Company", Value = "Courier"},
                                        new SelectListItem { Text="Physical Driver", Value = "Driver"},
                                    }, "---Select one---", new { onchange = "this.form.submit()" })
                                }
                                @Html.ValidationMessageFor(model => model.DeliveryChoice, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <br /><br />

                        @if (Model.DeliveryChoice != null && Model.DeliveryChoice.Equals("Courier"))
                        {
                            <div class="form-group">
                                @Html.LabelFor(a => a.WaybillNumber, "Waybill Number", new { @class = "col-md-2 control-label" })
                                <div class="col-md-2">
                                    @Html.TextBoxFor(a => a.WaybillNumber)
                                </div>
                            </div>
                            <br /><br />
                        }

                        else if (Model.DeliveryChoice != null && Model.DeliveryChoice.Equals("Driver"))
                        {
                            <div class="form-group">
                                @Html.LabelFor(a => a.DriverDetails, "Driver Details", new { @class = "col-md-2 control-label" })
                                <div class="col-md-10">
                                    @Html.TextAreaFor(a => a.DriverDetails)
                                </div>
                            </div>
                            <br /><br />

                            <div class="form-group">
                                @Html.LabelFor(a => a.DriverContacts, "Driver Contacts", new { @class = "col-md-2 control-label" })
                                <div class="col-md-2">
                                    @Html.TextBoxFor(a => a.DriverContacts)
                                </div>
                            </div>
                            <br /><br />
                        }

                        <div class="form-group">
                            @Html.LabelFor(a => a.Quantity, "Item Quantity", new { @class = "col-md-2 control-label" })
                            <div class="col-md-10">
                                @Html.DropDownListFor(a => a.Quantity, new SelectList(Model.QuantityList, ""), "---Select one---", new { @id = "Quantity" })
                            </div>
                            @Html.ValidationMessageFor(model => model.Quantity, "", new { @class = "text-danger" })
                        </div>

                        <br /><br />

                        <div class="form-group">
                            @Html.LabelFor(a => a.Comment, "Comment", new { @class = "col-md-2 control-label" })
                            <div class="col-md-10">
                                @Html.TextAreaFor(a => a.Comment)
                            </div>
                        </div>

                        <br /><br />

                        <button class="btn btn-large btn-primary" id="btnSubmit" type="submit" style="text-align:left">Send</button>
                        <P> 
                            <a href="http://localhost:33330/Pps/Home" style="text-align:right" class="col-md-11 control-label">Back to previous page</a>
                        </P>

                    </fieldset>


                }

            </div>

            <div id="Courier" class="tab-pane fade in">
                <div class="table-responsive table table-striped">
                    @if (Model.CourierDeliveryDisplay != null)
                    {
                    <h3>Packages Sent By Courier Company</h3>
                    <table class="table">
                        <thead style="color:black; background-color:white">
                            <tr>
                                <th>Waybill Number</th>
                                <th>Package Quantity</th>
                                <th>Package Sender</th>
                                <th>Date Sent</th>
                                <th>Package Recipient</th>
                                <th>Date received</th>
                                <th>Delivery Status</th>
                                <th>Contract Numbers</th>
                                <th>Comment</th>
                            </tr>
                        </thead>

                        <tbody>
                            @for (int i = 0; i < Model.CourierDeliveryDisplay.Count; i++)
                                {
                                    var deliveryInfo = Model.CourierDeliveryDisplay[i];

                                <tr>
                                    <td>@deliveryInfo.PackageNumber</td>
                                    <td>@deliveryInfo.Quantity</td>
                                    <td>@deliveryInfo.PackageSender</td>
                                    <td>@deliveryInfo.DateSent</td>
                                    <td>@deliveryInfo.PackageRecipient</td>
                                    <td>@deliveryInfo.DateReceived</td>
                                    <td>@deliveryInfo.CourierStatus</td>
                                    <td>
                                        @for (int j = 0; j < Model.ContractsDisplay.Count; j++)
                                            {
                                                var contract = Model.ContractsDisplay[j];
                                                if (contract.RecordNumber.Equals(deliveryInfo.RecordNumber))
                                                {
                                            <div class="checkbox">
                                                @if ((bool)contract.IsReceived)
                                                        {
                                                        @Html.CheckBox("checkbox", new { @checked = "checked", @disabled = "true" }) @contract.ContractNumber1 <br />
                                                        }
                                                        else
                                                        {
                                                        @Html.CheckBox("checkbox", new { @disabled = "true" }) @contract.ContractNumber1 <br />
                                                        }
                                            </div>

                                                }
                                            }
                                    </td>
                                    <td>@deliveryInfo.Comment</td>
                                </tr>
                                }
                        </tbody>

                    </table>
                    }
                </div>
            </div>

            <div id="Driver" class="tab-pane fade in">
                <div class="table-responsive table table-striped">
                    @if (Model.DriverDeliveryDisplay != null)
                    {
                    <h3>Packages Sent By Driver</h3>
                    <table class="table">
                        <thead style="color:black; background-color:white">
                            <tr>
                                <th>Driver Details</th>
                                <th>Driver Contacts</th>
                                <th>Package Quantity</th>
                                <th>Package Sender</th>
                                <th>Date Sent</th>
                                <th>Package Recipient</th>
                                <th>Date received</th>
                                <th>Delivery Status</th>
                                <th>Contract Numbers</th>
                                <th>Comment</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.DriverDeliveryDisplay.Count; i++)
                                {
                                    var deliveryInfo = Model.DriverDeliveryDisplay[i];
                                <tr>
                                    <td>@deliveryInfo.DriverDetails</td>
                                    <td>@deliveryInfo.DriverContact</td>
                                    <td>@deliveryInfo.Quantity</td>
                                    <td>@deliveryInfo.PackageSender</td>
                                    <td>@deliveryInfo.DateSent</td>
                                    <td>@deliveryInfo.PackageRecipient</td>
                                    <td>@deliveryInfo.DateReceived</td>
                                    <td>@deliveryInfo.CourierStatus</td>
                                    <td>
                                        @for (int j = 0; j < Model.ContractsDisplay.Count; j++)
                                            {
                                                var contract = Model.ContractsDisplay[j];
                                                if (contract.RecordNumber.Equals(deliveryInfo.RecordNumber))
                                                {
                                            <div class="checkbox">
                                                @if ((bool)contract.IsReceived)
                                                        {
                                                        @Html.CheckBox("checkbox", new { @checked = "checked", @disabled = "true" }) @contract.ContractNumber1 <br />
                                                        }
                                                        else
                                                        {
                                                        @Html.CheckBox("checkbox", new { @disabled = "true" }) @contract.ContractNumber1 <br />
                                                        }
                                            </div>
                                                }
                                            }
                                    </td>

                                    <td>@deliveryInfo.Comment</td>
                                </tr>

                                }
                        </tbody>
                    </table>
                    }
                </div>
            </div>

            <div id="SearchNatis" class="tab-pane fade in">
                <div class="table-responsive">
                    <table id="searchTable" class="table table-striped table-bordered">
                        <thead style="color:black; background-color:white">
                            <tr>
                                <th>Date Scanned</th>
                                <th>Contract Numbers</th>
                                <th>VIN Number</th>
                                <th>Registration Number</th>
                                <th>Engine Number</th>
                                <th>Car Make</th>
                                <th>Series Number</th>
                                <th>Description</th>
                                <th>Registration Date</th>
                                <th>Owner name</th>
                                <th>Owner ID</th>
                                <th>Natis Location</th>
                                <th>Contract Status</th>
                                <th>eNatis PDF</th>
                            </tr>
                        </thead>

                        <tbody>
                            @for (int i = 0; i < Model.NatisDataList.Count; i++)
                            {
                                string contractNumber = "";
                                string contractStatus = "";
                                string statusDescription = "";

                                for (int j = 0; j < Model.NatisDataList[i].contractInformation.Count; j++)
                                {
                                    if (Model.NatisDataList[i].contractInformation[j].VinNumber.Equals(Model.NatisDataList[i].vin))
                                    {
                                        contractNumber = Model.NatisDataList[i].contractInformation[j].ContractNumber;
                                        contractStatus = Model.NatisDataList[i].contractInformation[j].ContractStatus;
                                        statusDescription = Model.NatisDataList[i].contractInformation[j].StatusDescription;
                                    }

                                }

                                <tr>
                                    <td>@Model.NatisDataList[i].DateScanned</td>
                                    <td>@contractNumber</td>
                                    <td>@Model.NatisDataList[i].vin</td>
                                    <td>@Model.NatisDataList[i].registrationNo</td>
                                    <td>@Model.NatisDataList[i].engineNo</td>
                                    <td>@Model.NatisDataList[i].carMake</td>
                                    <td>@Model.NatisDataList[i].seriesNo</td>
                                    <td>@Model.NatisDataList[i].description</td>
                                    <td>@Model.NatisDataList[i].registrationDate</td>
                                    <td>@Model.NatisDataList[i].OwnerName</td>
                                    <td>@Model.NatisDataList[i].OwnerID</td>
                                    <td>@Model.NatisDataList[i].natisLocation</td>
                                    <td>@contractStatus</td>
                                    <td>@Html.ActionLink("View Natis", "ViewNatis", new { id = Model.NatisDataList[i].RecordNumber, contractNo = contractNumber }, new { target = "_blank" })</td>
                                </tr>

                            }
                        </tbody>

                        <tfoot style="color:black; background-color:white">
                            <tr>
                                <th>Date Scanned</th>
                                <th>Contract Numbers</th>
                                <th>VIN Number</th>
                                <th>Registration Number</th>
                                <th>Engine Number</th>
                                <th>Car Make</th>
                                <th>Series Number</th>
                                <th>Description</th>
                                <th>Registration Date</th>
                                <th>Owner name</th>
                                <th>Owner ID</th>
                                <th>Natis Location</th>
                                <th>Contract Status</th>
                                <th>eNatis PDF</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>

            </div>
        </div>

    </div>

    <script src="~/Scripts/jquery-1.12.4.min.js"></script>
    <script src="~/Scripts/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <script type="text/javascript">
        $(function () {
            $("#btnSubmit").click(function () {

                var contracts = "";
                var q = $("#Quantity").val();
                for (var i = 1; i <= q; i++) {
                    debugger;
                    var con = prompt("Please enter Proposal Number " + i + " of " + q, "");
                    var length = con.length;
                    var IsNotNumber = isNaN(con);                        

                    //while invalid entry
                    while (length < 6 || IsNotNumber) {
                        alert("Proposal Number "+i+" of "+q+" is Incorrect, Please try again");
                        con = prompt("Please enter Proposal Number " + i + " of " + q, "");
                        length = con.length;
                        IsNotNumber = isNaN(con);
                    }
                    contracts = contracts + con + " ";
                }

                $("#@Html.IdFor(model => model.ContractStrings)").val(contracts);

            });

            $('#searchTable').DataTable({
                "dom": '<"top"if>rt<"clear"><"bottom"lp>', language: {
                    search: "_INPUT_", //To remove Search Label
                    searchPlaceholder: "Search..."
                }
            });
        });
    </script>


    @*<div id='myModal' class='modal'>
        <div class="modal-dialog">
            <div class="modal-content">
                <div id='myModalContent'></div>
            </div>
        </div>

    </div>

    @section scripts
{
        <script src="~/Scripts/jquery-1.10.2.min.js"></script>
        <script src="~/Scripts/bootstrap.js"></script>
        <script src="~/Scripts/bootstrap.min.js"></script>
        <script>

            var TeamDetailPostBackURL = '/Users/Details';
            $(function () {
                $("#btnSubmit").click(function () {
                    console.log(5 + 6);
                    debugger;
                    var id = $("#Quantity").val();
                    var options = { "backdrop": "static", keyboard: true };
                    $.ajax({
                        type: "GET",
                        url: TeamDetailPostBackURL,
                        contentType: "application/json; charset=utf-8",
                        data: { "Id": id },
                        datatype: "json",
                        success: function (data) {
                            debugger;
                            $('#myModalContent').html(data);
                            $('#myModal').modal(options);
                            $('#myModal').modal('show');

                        },
                        error: function () {
                            debugger;
                            alert("Dynamic content load failed.");
                        }
                    });
                });
                //$("#closebtn").on('click',function(){
                //    $('#myModal').modal('hide');

                $("#closbtn").click(function () {
                    $('#myModal').modal('hide');
                });
            });

        </script>

    }*@

</body>

</html>